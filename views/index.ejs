<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meta VCF - Collect Contacts</title>
  <style>
    :root{ --teal:#13e6c9; --muted:#94a3b8; }
    body { font-family: Inter, system-ui, sans-serif; background: black; color: #e6eef0; margin:0; padding:0; min-height:100vh; overflow-x:hidden; }
    .bg-video { position: fixed; right: 0; bottom: 0; min-width: 100%; min-height: 100%; width: auto; height: auto; z-index: -2; object-fit: cover; opacity: 0.12; }
    .bg-overlay { position: fixed; inset: 0; background: linear-gradient(180deg, rgba(3,7,10,0.55), rgba(3,7,10,0.7)); z-index:-1; }
    header{ display:flex; align-items:center; justify-content:space-between; padding:16px 20px; position:relative; z-index:10; }
    .left-controls { display:flex; align-items:center; gap:12px; }
    .hamburger { width:40px; height:40px; display:inline-flex; align-items:center; justify-content:center; background:#061018; border-radius:8px; border:1px solid #17303a; cursor:pointer; }
    h1{ color:var(--teal); margin:0; font-size:20px; font-weight:800; }
    main{ max-width:760px; margin:40px auto; padding:20px; position:relative; z-index:5; }
    .warning{ background:#7c2d12; color:#ffedd5; padding:12px; border-radius:8px; margin-bottom:20px; border:1px solid #ea580c; }
    .progress-box{ background:#0f1724; padding:18px; border-radius:12px; border:1px solid #17303a; margin-bottom:20px; }
    .form{ background:#0b1220; padding:18px; border-radius:12px; border:1px solid #17303a; }
    input{ width:100%; padding:10px; border-radius:8px; border:1px solid #17303a; background:#061018; color:#fff; margin-top:6px; }
    button{ width:100%; padding:12px; border-radius:10px; background:var(--teal); color:#042027; border:none; font-weight:700; margin-top:12px; }
    .btn{ display:inline-block; padding:10px 18px; border-radius:8px; background:#25d366; color:#fff; text-decoration:none; font-weight:600; }
    
    /* Sidebar styles with close button */
    .sidebar { 
      position: fixed; 
      top: 0; 
      left: -320px; 
      width: 300px; 
      height: 100%; 
      background: rgba(2,6,9,0.96); 
      backdrop-filter: blur(6px); 
      border-right: 1px solid #17303a; 
      padding: 20px; 
      transition: left 220ms ease; 
      z-index:30;
      box-shadow: 4px 0 15px rgba(0,0,0,0.5);
      overflow-y: auto;
    }
    
    .sidebar.open { 
      left: 0; 
    } 
    
    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #17303a;
    }
    
    .sidebar-header h3 { 
      color: var(--teal); 
      margin: 0;
      font-size:20px; 
    }
    
    .close-btn {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #061018;
      border: 1px solid #17303a;
      border-radius: 8px;
      cursor: pointer;
      color: #94a3b8;
      transition: all 0.2s;
    }
    
    .close-btn:hover {
      background: #17303a;
      color: #ffb4b4;
    }
    
    .sidebar a {
      display:block; 
      color:#e6eef0; 
      text-decoration:none; 
      padding:12px 14px; 
      margin-bottom:10px; 
      border-radius:8px; 
      background:#061018; 
      border:1px solid #17303a;
      transition: all 0.2s;
    }
    
    .sidebar a:hover {
      background: #17303a;
      border-color: var(--teal);
    }
    
    .sidebar hr {
      border:none;
      border-top:1px solid #17303a;
      margin:16px 0;
    }
    
    .sidebar small {
      color:#94a3b8;
      display: block;
      text-align: center;
    }
    
    /* Overlay for when sidebar is open */
    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(2px);
      z-index: 25;
      display: none;
    }
    
    .sidebar-overlay.active {
      display: block;
    }
    
    footer{ text-align:center; padding:20px; color:#6b7280; border-top:1px solid #17303a; margin-top:30px; position:relative; z-index:5; }
    
    @media (max-width:640px){ 
      main{ margin:24px 16px; } 
      .sidebar{ width:84%; } 
    }
  </style>
</head>
<body>
  <video id="bgVideo" class="bg-video" autoplay muted loop playsinline preload="auto">
    <source src="/assets/download.mp4" type="video/mp4">
  </video>
  <div class="bg-overlay"></div>
  
  <!-- Overlay for sidebar -->
  <div id="sidebarOverlay" class="sidebar-overlay"></div>

  <header>
    <div class="left-controls">
      <button id="hamburgerBtn" class="hamburger" aria-label="menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 6h18M3 12h18M3 18h18"/>
        </svg>
      </button>
      <h1>üöÄ Meta VCF</h1>
    </div>
    <div style="color:#94a3b8; font-size:13px;">Build by <strong>Meta Team</strong></div>
  </header>

  <aside id="sidebar" class="sidebar" aria-hidden="true">
    <div class="sidebar-header">
      <h3>Menu</h3>
      <button id="closeSidebarBtn" class="close-btn" aria-label="Close menu">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>
    
    <a href="<%= otherProject %>" target="_blank" rel="noreferrer">üìÅ Visit Other Projects</a>
    <a href="/admin-login">üîê Admin Panel</a>
    <hr>
    <small>¬© 2026 Meta Team</small>
  </aside>

  <main>
    <div class="warning">
      <strong>‚ö†Ô∏è Important Notice:</strong> If you don't join the group or follow the channel, don't blame me if you miss the file! Make sure to join and stay active.
    </div>

    <section class="progress-box">
      <h2>üìä Live Progress Tracker</h2>
      <div style="display:flex; gap:12px; margin-top:12px;">
        <div style="flex:1; background:#061018; padding:12px; border-radius:8px; border:1px solid #17303a;">
          <div style="color:#94a3b8; font-size:12px;">Collected</div>
          <div style="font-size:24px; color:#13e6c9; font-weight:700;" id="collected"><%= collected %></div>
        </div>
        <div style="flex:1; background:#061018; padding:12px; border-radius:8px; border:1px solid #17303a;">
          <div style="color:#94a3b8; font-size:12px;">Remaining</div>
          <div style="font-size:24px; color:#13e6c9; font-weight:700;" id="remaining"><%= remaining %></div>
        </div>
      </div>
      <div style="text-align:center; margin-top:12px; font-size:28px; color:#4ade80;" id="percent"><%= percent %>%</div>
    </section>

    <section class="form">
      <h3>üìù Submit Your Contact</h3>
      <form id="contactForm">
        <div>
          <label>Full Name</label>
          <input type="text" id="full_name" name="full_name" placeholder="Enter your full name" required />
        </div>
        <div style="margin-top:12px;">
          <label>Phone Number</label>
          <input type="tel" id="phone" name="phone" placeholder="+1234567890" required />
          <small style="color:#94a3b8;">Use international format (e.g., +1234567890)</small>
        </div>
        <button type="submit" id="submitBtn">Submit Contact</button>
        <div id="message"></div>
      </form>
    </section>

    <section style="text-align:center; margin-top:18px;">
      <a class="btn" href="<%= whatsappLink %>" target="_blank" rel="noreferrer">üí¨ Join WhatsApp Group</a>
    </section>
  </main>

  <footer>
    <small><%= footerCredit %></small>
  </footer>

  <script>
    // Sidebar elements
    const sidebar = document.getElementById('sidebar');
    const ham = document.getElementById('hamburgerBtn');
    const closeBtn = document.getElementById('closeSidebarBtn');
    const overlay = document.getElementById('sidebarOverlay');
    
    // Function to open sidebar
    function openSidebar() {
      sidebar.classList.add('open');
      overlay.classList.add('active');
      sidebar.setAttribute('aria-hidden', 'false');
    }
    
    // Function to close sidebar
    function closeSidebar() {
      sidebar.classList.remove('open');
      overlay.classList.remove('active');
      sidebar.setAttribute('aria-hidden', 'true');
    }
    
    // Toggle sidebar with hamburger button
    ham.addEventListener('click', (e) => {
      e.stopPropagation();
      if (sidebar.classList.contains('open')) {
        closeSidebar();
      } else {
        openSidebar();
      }
    });
    
    // Close sidebar with close button
    closeBtn.addEventListener('click', closeSidebar);
    
    // Close sidebar when clicking overlay
    overlay.addEventListener('click', closeSidebar);
    
    // Close sidebar with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && sidebar.classList.contains('open')) {
        closeSidebar();
      }
    });

    // Try to play video (some browsers block autoplay unless muted + user gesture)
    const bgVideo = document.getElementById('bgVideo');
    if (bgVideo) {
      const p = bgVideo.play();
      if (p !== undefined) {
        p.catch(() => {
          // Autoplay blocked ‚Äî leave muted and it will play on user gesture.
        });
      }
    }

    // contact submission & polling
    async function fetchCount() {
      try {
        const res = await fetch('/api/count');
        if (res.ok) {
          const data = await res.json();
          document.getElementById('collected').textContent = data.collected;
          document.getElementById('remaining').textContent = data.remaining;
          document.getElementById('percent').textContent = data.percent + '%';
        }
      } catch (err) { console.error(err); }
    }

    document.getElementById('contactForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const full_name = document.getElementById('full_name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const submitBtn = document.getElementById('submitBtn');
      const messageDiv = document.getElementById('message');

      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';
      messageDiv.textContent = '';

      try {
        const res = await fetch('/api/contacts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ full_name, phone }),
        });

        if (res.ok) {
          messageDiv.className = 'message success';
          messageDiv.textContent = '‚úÖ Contact submitted! Thank you!';
          document.getElementById('full_name').value = '';
          document.getElementById('phone').value = '';
          fetchCount();
        } else {
          const json = await res.json();
          messageDiv.className = 'message error';
          messageDiv.textContent = '‚ùå ' + (json?.message || 'Failed to submit');
        }
      } catch (err) {
        messageDiv.className = 'message error';
        messageDiv.textContent = '‚ùå Network error';
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Contact';
      }
    });

    fetchCount();
    setInterval(fetchCount, 5000);
  </script>
</body>
</html>