<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meta VCF - Collect Contacts</title>
  <style>
    /* simplified styles (dark theme) */
    body { font-family: Inter, system-ui, sans-serif; background: linear-gradient(135deg,#0b1220 0%,#071124 100%); color: #e6eef0; margin:0; padding:0; }
    header{ display:flex; justify-content:space-between; align-items:center; padding:20px; border-bottom:1px solid #17303a;}
    h1{ color:#13e6c9; margin:0;}
    main{ max-width:760px; margin:20px auto; padding:20px;}
    .warning{ background:#7c2d12; color:#ffedd5; padding:12px; border-radius:8px; margin-bottom:20px; border:1px solid #ea580c;}
    .progress-box{ background:#0f1724; padding:18px; border-radius:12px; border:1px solid #17303a; margin-bottom:20px;}
    .form{ background:#0b1220; padding:18px; border-radius:12px; border:1px solid #17303a;}
    input{ width:100%; padding:10px; border-radius:8px; border:1px solid #17303a; background:#061018; color:#fff; margin-top:6px;}
    button{ width:100%; padding:12px; border-radius:10px; background:#13e6c9; color:#042027; border:none; font-weight:700; margin-top:12px;}
    .download{ text-align:center; margin-top:18px;}
    a.btn{ display:inline-block; padding:10px 18px; border-radius:8px; background:#25d366; color:#fff; text-decoration:none; font-weight:600;}
    .message{ margin-top:12px; padding:10px; border-radius:8px; }
    .message.success{ background:#064e3b; color:#c7f4e9; border:1px solid #10b981;}
    .message.error{ background:#7f1d1d; color:#ffb4b4; border:1px solid #ef4444;}
  </style>
</head>
<body>
  <header>
    <div>
      <h1>üöÄ Meta VCF</h1>
      <div style="color:#6b7280;">Collect contacts & generate VCF files</div>
    </div>
    <nav>
      <a href="https://your-other-projects.example" style="color:#79fff0; margin-right:12px;" target="_blank" rel="noreferrer">üìÅ Other Projects</a>
      <a href="/admin-login" style="color:#79fff0;">üîê Admin</a>
    </nav>
  </header>

  <main>
    <div class="warning">
      <strong>‚ö†Ô∏è Important Notice:</strong> If you don't join the group or follow the channel, don't blame me if you miss the file! Make sure to join and stay active.
    </div>

    <section class="progress-box">
      <h2>üìä Live Progress Tracker</h2>
      <div style="display:flex; gap:12px; margin-top:12px;">
        <div style="flex:1; background:#061018; padding:12px; border-radius:8px; border:1px solid #17303a;">
          <div style="color:#94a3b8; font-size:12px;">Collected</div>
          <div style="font-size:24px; color:#13e6c9; font-weight:700;" id="collected"><%= collected %></div>
        </div>
        <div style="flex:1; background:#061018; padding:12px; border-radius:8px; border:1px solid #17303a;">
          <div style="color:#94a3b8; font-size:12px;">Remaining</div>
          <div style="font-size:24px; color:#13e6c9; font-weight:700;" id="remaining"><%= remaining %></div>
        </div>
      </div>
      <div style="text-align:center; margin-top:12px; font-size:28px; color:#4ade80;" id="percent"><%= percent %>%</div>
    </section>

    <section class="form">
      <h3>üìù Submit Your Contact</h3>
      <form id="contactForm">
        <div>
          <label>Full Name</label>
          <input type="text" id="full_name" name="full_name" placeholder="Enter your full name" required />
        </div>
        <div style="margin-top:12px;">
          <label>Phone Number</label>
          <input type="tel" id="phone" name="phone" placeholder="+1234567890" required />
          <small style="color:#94a3b8;">Use international format (e.g., +1234567890)</small>
        </div>
        <button type="submit" id="submitBtn">Submit Contact</button>
        <div id="message"></div>
      </form>
    </section>

    <section class="download">
      <a class="btn" href="/api/admin/export-vcf">‚¨áÔ∏è Download VCF (when target is met)</a>
    </section>

    <section style="text-align:center; margin-top:18px;">
      <a class="btn" href="<%= whatsappLink %>" target="_blank" rel="noreferrer">üí¨ Join WhatsApp Group</a>
    </section>
  </main>

  <footer style="text-align:center; padding:20px; color:#6b7280; border-top:1px solid #17303a; margin-top:30px;">
    <small>&copy; 2026 Meta VCF</small>
  </footer>

  <script>
    async function fetchCount() {
      try {
        const res = await fetch('/api/count');
        if (res.ok) {
          const data = await res.json();
          document.getElementById('collected').textContent = data.collected;
          document.getElementById('remaining').textContent = data.remaining;
          document.getElementById('percent').textContent = data.percent + '%';
        }
      } catch (err) {
        console.error(err);
      }
    }

    document.getElementById('contactForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const full_name = document.getElementById('full_name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const submitBtn = document.getElementById('submitBtn');
      const messageDiv = document.getElementById('message');

      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';
      messageDiv.textContent = '';

      try {
        const res = await fetch('/api/contacts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ full_name, phone }),
        });

        if (res.ok) {
          messageDiv.className = 'message success';
          messageDiv.textContent = '‚úÖ Contact submitted! Thank you!';
          document.getElementById('full_name').value = '';
          document.getElementById('phone').value = '';
          fetchCount();
        } else {
          const json = await res.json();
          messageDiv.className = 'message error';
          messageDiv.textContent = '‚ùå ' + (json?.message || 'Failed to submit');
        }
      } catch (err) {
        messageDiv.className = 'message error';
        messageDiv.textContent = '‚ùå Network error';
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Contact';
      }
    });

    fetchCount();
    setInterval(fetchCount, 5000);
  </script>
</body>
</html>